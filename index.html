<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedRecord</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="toast" class="toast hidden"></div>

    <!-- Auth Section -->
    <div id="authContainer" class="auth-container">
        <div class="auth-box">
            <div class="logo center mb-4">
                <i class="fa-solid fa-heart-pulse"></i>
                <span>MedRecord</span>
            </div>
            
            <form id="loginForm" class="auth-form" onsubmit="app.auth.login(event)">
                <h2 data-i18n="login_title">Welcome Back</h2>
                <div class="form-group">
                    <label data-i18n="login_id_label">Phone Number or National ID</label>
                    <input type="text" id="loginId" required>
                </div>
                <div class="form-group">
                    <label data-i18n="password">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn primary-btn full-width" data-i18n="login_btn">Login</button>
                <div class="auth-switch">
                    <span data-i18n="no_account">Don't have an account?</span> 
                    <a href="#" onclick="app.ui.showRegister()" data-i18n="register_link">Register here</a>
                </div>
            </form>

            <form id="registerForm" class="auth-form hidden" onsubmit="app.auth.register(event)">
                <h2 data-i18n="register_title">Create Account</h2>
                <div class="form-group">
                    <label data-i18n="national_id">National ID</label>
                    <input type="text" id="regId" required>
                </div>
                <div class="form-group">
                    <label data-i18n="full_name">Full Name</label>
                    <input type="text" id="regName" required>
                </div>
                <div class="form-row">
                    <div class="form-group half">
                        <label data-i18n="phone">Phone Number</label>
                        <input type="tel" id="regPhone" required>
                    </div>
                    <div class="form-group half">
                        <label data-i18n="email">Email</label>
                        <input type="email" id="regEmail">
                    </div>
                </div>
                <div class="form-group">
                    <label data-i18n="password">Password</label>
                    <input type="password" id="regPassword" required>
                </div>
                <button type="submit" class="btn primary-btn full-width" data-i18n="register_btn">Register</button>
                
                <div class="auth-switch">
                    <span data-i18n="has_account">Already have an account?</span> 
                    <a href="#" onclick="app.ui.showLogin()" data-i18n="login_link">Login here</a>
                </div>
            </form>
        </div>
    </div>

    <!-- App Section -->
    <div id="appContainer" class="app-container hidden">
        <aside class="sidebar">
            <div class="logo">
                <i class="fa-solid fa-heart-pulse"></i>
                <span>MedRecord</span>
            </div>
            <nav class="nav-menu" id="navMenu"></nav>
        </aside>

        <main class="main-content">
            <!-- Global header -->
            <header class="top-header">
                <div class="header-left">
                    <!-- Doctor Search -->
                    <div class="search-bar hidden" id="doctorSearch">
                        <i class="fa-solid fa-search"></i>
                        <input type="text" id="patientSearchInput" data-i18n-prop="placeholder" data-i18n="search_patient_placeholder" placeholder="Enter Patient National ID...">
                        <button class="btn primary-btn" onclick="app.doctor.searchPatient()" data-i18n="search_btn">Search</button>
                    </div>

                    <!-- Patient Doctor Search -->
                    <div class="search-bar hidden" id="patientDoctorSelect">
                        <i class="fa-solid fa-user-doctor"></i>
                        <input type="text" id="doctorSearchInput" data-i18n-prop="placeholder" data-i18n="search_doc_placeholder" placeholder="Enter Doctor Name...">
                        <button class="btn primary-btn" onclick="app.patient.searchDoctor()" data-i18n="search_btn">Search</button>
                    </div>
                </div>

                <div class="header-right">
                    <div id="roleSwitcher" class="hidden" style="margin-right: 12px;">
                        <button class="btn secondary-btn small" onclick="app.ui.toggleRoleSwitch()">
                            <i class="fa-solid fa-repeat"></i> <span id="currentRoleLabel">Patient</span>
                        </button>
                    </div>
                    
                    <button id="langToggle" class="btn text-btn" onclick="app.i18n.toggle()">
                        <i class="fa-solid fa-language"></i> <span id="langText">عربي</span>
                    </button>
                    
                    <div class="user-profile-header">
                        <div class="avatar-container small" onclick="app.profile.triggerUpload()">
                            <div class="avatar x-small" id="headerAvatar">U</div>
                            <div class="avatar-overlay"><i class="fa-solid fa-camera"></i></div>
                        </div>
                        <div class="user-meta-header">
                            <span class="user-name" id="headerName">Name</span>
                        </div>
                    </div>

                    <button class="logout-btn icon-btn" onclick="app.auth.logout()" title="Logout">
                        <i class="fa-solid fa-right-from-bracket"></i>
                    </button>
                </div>
            </header>

            <div class="dashboard-content" id="mainView">
                <!-- Content injected here -->
            </div>
        </main>
    </div>

    <input type="file" id="profilePicInput" class="hidden" accept="image/*" onchange="app.profile.handleUpload(event)">
    
    <!-- Camera Modal -->
    <div id="cameraModal" class="modal hidden">
        <div class="modal-content">
            <div class="card">
                <div class="card-header">
                    <h2>Capture Prescription</h2>
                    <button class="btn icon-btn" onclick="app.ui.hideCamera()"><i class="fa-solid fa-times"></i></button>
                </div>
                <div style="background:#000; border-radius:12px; overflow:hidden; position:relative; aspect-ratio:4/3; display:flex; align-items:center; justify-content:center;">
                    <video id="cameraVideo" autoplay playsinline style="width:100%; height:100%; object-fit:cover;"></video>
                    <canvas id="cameraCanvas" class="hidden"></canvas>
                </div>
                <div class="text-center mt-3" style="display:flex; justify-content:center; gap:12px;">
                    <button class="btn secondary-btn" onclick="app.ui.hideCamera()">Cancel</button>
                    <button class="btn primary-btn" onclick="app.patient.captureImage()"><i class="fa-solid fa-camera"></i> Capture</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JS Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
